(function(c){"function"===typeof define&&define.amd?define(["jquery","./grid.base","./jquery.fmatter","./grid.common"],c):"object"===typeof exports?c(require("jquery")):c(jQuery)})(function(c){var u=c.jgrid,C=function(){var a=c.makeArray(arguments);a.unshift("");a.unshift("");a.unshift(this.p);return u.feedback.apply(this,a)},D=function(a,b){var g=this.grid.fbRows;return c((null!=g&&g[0].cells.length>b?g[a.rowIndex]:a).cells[b])};u.extend({editCell:function(a,b,g){return this.each(function(){var d=
this,e=c(d),f=d.p,l,k,h,n;l=d.rows;if(d.grid&&!0===f.cellEdit&&null!=l&&null!=l[a]&&(a=parseInt(a,10),b=parseInt(b,10),!isNaN(a)&&!isNaN(b))){var t=l[a],m=null!=t?t.id:null,p=c(t),q=parseInt(f.iCol,10),v=parseInt(f.iRow,10),B=c(l[v]),x=f.savedRow;if(null!=m){f.selrow=m;f.knv||e.jqGrid("GridNav");if(0<x.length){if(!0===g&&a===v&&b===q)return;e.jqGrid("saveCell",x[0].id,x[0].ic)}else setTimeout(function(){c("#"+u.jqID(f.knv)).attr("tabindex","-1").focus()},1);n=f.colModel[b];l=n.name;if("subgrid"!==
l&&"cb"!==l&&"rn"!==l){h=D.call(d,t,b);t=n.editable;c.isFunction(t)&&(t=t.call(d,{rowid:m,iCol:b,iRow:a,name:l,cm:n,mode:"cell"}));var w=e.jqGrid("getGuiStyles","states.select","edit-cell"),y=e.jqGrid("getGuiStyles","states.hover","selected-row");if(!0!==t||!0!==g||h.hasClass("not-editable-cell"))0<=q&&0<=v&&(D.call(d,B[0],q).removeClass(w),B.removeClass(y)),h.addClass(w),p.addClass(y),k=h.html().replace(/&#160;/ig,""),C.call(d,"onSelectCell",m,l,k,a,b);else{0<=q&&0<=v&&(D.call(d,B[0],q).removeClass(w),
B.removeClass(y));h.addClass(w);p.addClass(y);n.edittype||(n.edittype="text");p=n.edittype;try{k=c.unformat.call(d,h,{rowId:m,colModel:n},b)}catch(F){k="textarea"===p?h.text():h.html()}f.autoEncodeOnEdit&&(k=u.oldDecodePostedData(k));x.push({id:a,ic:b,name:l,v:k});if("&nbsp;"===k||"&#160;"===k||1===k.length&&160===k.charCodeAt(0))k="";c.isFunction(f.formatCell)&&(q=f.formatCell.call(d,m,l,k,a,b),void 0!==q&&(k=q));C.call(d,"beforeEditCell",m,l,k,a,b);n=c.extend({},n.editoptions||{},{id:a+"_"+l,name:l,
rowId:m,mode:"cell",cm:n,iCol:b});var z=u.createEl.call(d,p,n,k,!0,c.extend({},u.ajaxOptions,f.ajaxSelectOptions||{})),p=h;(q=!0===f.treeGrid&&l===f.ExpandColumn)&&(p=h.children("span.cell-wrapperleaf,span.cell-wrapper"));p.html("").append(z).attr("tabindex","0");q&&c(z).width(h.width()-h.children("div.tree-wrap").outerWidth());u.bindEv.call(d,z,n);setTimeout(function(){c(z).focus()},1);c("input, select, textarea",h).bind("keydown",function(g){27===g.keyCode&&(0<c("input.hasDatepicker",h).length?
c(".ui-datepicker").is(":hidden")?e.jqGrid("restoreCell",a,b):c("input.hasDatepicker",h).datepicker("hide"):e.jqGrid("restoreCell",a,b));if(13===g.keyCode&&!g.shiftKey)return e.jqGrid("saveCell",a,b),!1;if(9===g.keyCode){if(d.grid.hDiv.loading)return!1;g.shiftKey?e.jqGrid("prevCell",a,b):e.jqGrid("nextCell",a,b)}g.stopPropagation()});C.call(d,"afterEditCell",m,l,k,a,b);e.triggerHandler("jqGridAfterEditCell",[m,l,k,a,b])}f.iCol=b;f.iRow=a}}}})},saveCell:function(a,b){return this.each(function(){var g=
this,d=c(g),e=g.p,f=g.grid,l=u.info_dialog,k=u.jqID;if(f&&!0===e.cellEdit){var h=d.jqGrid("getGridRes","errors"),n=h.errcap,t=d.jqGrid("getGridRes","edit").bClose,m=e.savedRow,p=1<=m.length?0:null;if(null!==p){var q=g.rows[a],v=q.id,B=c(q),x=e.colModel[b],w=x.name,y,z=D.call(g,q,b),F={},r=u.getEditedValue.call(g,z,x,F);if(r!==m[p].v){y=d.triggerHandler("jqGridBeforeSaveCell",[v,w,r,a,b]);void 0!==y&&(r=y);c.isFunction(e.beforeSaveCell)&&(y=e.beforeSaveCell.call(g,v,w,r,a,b),void 0!==y&&(r=y));var E=
u.checkValues.call(g,r,b,void 0,void 0,{oldValue:m[p].v,newValue:r,cmName:w,rowid:v,iCol:b,iRow:a,cm:x,tr:q,td:z,mode:"cell"}),q=x.formatoptions||{};if(null==E||!0===E||!0===E[0]){p=d.triggerHandler("jqGridBeforeSubmitCell",[v,w,r,a,b])||{};c.isFunction(e.beforeSubmitCell)&&((p=e.beforeSubmitCell.call(g,v,w,r,a,b))||(p={}));0<c("input.hasDatepicker",z).length&&c("input.hasDatepicker",z).datepicker("hide");"date"===x.formatter&&!0!==q.sendFormatted&&(r=c.unformat.date.call(g,r,x));if("remote"===e.cellsubmit)if(e.cellurl){var A=
{};A[w]=r;h=e.prmNames;q=h.oper;A[h.id]=u.stripPref(e.idPrefix,v);A[q]=h.editoper;A=c.extend(p,A);e.autoEncodeOnEdit&&c.each(A,function(a,b){c.isFunction(b)||(A[a]=u.oldEncodePostedData(b))});d.jqGrid("progressBar",{method:"show",loadtype:e.loadui,htmlcontent:d.jqGrid("getGridRes","defaults.savetext")||"Saving..."});f.hDiv.loading=!0;c.ajax(c.extend({url:c.isFunction(e.cellurl)?e.cellurl.call(g,e.cellurl,a,b,v,r,w):e.cellurl,data:u.serializeFeedback.call(g,e.serializeCellData,"jqGridSerializeCellData",
A),type:"POST",complete:function(k){f.endReq.call(g);if((300>k.status||304===k.status)&&(0!==k.status||4!==k.readyState)){var h=d.triggerHandler("jqGridAfterSubmitCell",[g,k,A.id,w,r,a,b])||[!0,""];if(null==h||!0===h||!0===h[0]&&c.isFunction(e.afterSubmitCell))h=e.afterSubmitCell.call(g,k,A.id,w,r,a,b);null==h||!0===h||!0===h[0]?(d.jqGrid("setCell",v,b,r,!1,!1,!0),z.addClass("dirty-cell"),B.addClass("edited"),C.call(g,"afterSaveCell",v,w,r,a,b),m.splice(0,1)):(l.call(g,n,h[1],t),d.jqGrid("restoreCell",
a,b))}},error:function(h,k,f){d.triggerHandler("jqGridErrorCell",[h,k,f]);c.isFunction(e.errorCell)?e.errorCell.call(g,h,k,f):l.call(g,n,h.status+" : "+h.statusText+"<br/>"+k,t);d.jqGrid("restoreCell",a,b)}},u.ajaxOptions,e.ajaxCellOptions||{}))}else try{l.call(g,n,h.nourl,t),d.jqGrid("restoreCell",a,b)}catch(G){}"clientArray"===e.cellsubmit&&(d.jqGrid("setCell",v,b,"select"===x.edittype&&"select"!==x.formatter?F.text:r,!1,!1,!0),z.addClass("dirty-cell"),B.addClass("edited"),C.call(g,"afterSaveCell",
v,w,r,a,b),m.splice(0,1))}else try{setTimeout(function(){l.call(g,n,r+" "+E[1],t)},100),d.jqGrid("restoreCell",a,b)}catch(G){}}else d.jqGrid("restoreCell",a,b)}setTimeout(function(){c("#"+k(e.knv)).attr("tabindex","-1").focus()},0)}})},restoreCell:function(a,b){return this.each(function(){var g=this.p,d=this.rows[a],e=d.id,f,l;if(this.grid&&!0===g.cellEdit){var k=g.savedRow;f=D.call(this,d,b);if(1<=k.length){if(c.isFunction(c.fn.datepicker))try{c("input.hasDatepicker",f).datepicker("hide")}catch(h){}d=
g.colModel[b];!0===g.treeGrid&&d.name===g.ExpandColumn?f.children("span.cell-wrapperleaf,span.cell-wrapper").empty():f.empty();f.attr("tabindex","-1");f=k[0].v;l=d.formatoptions||{};"date"===d.formatter&&!0!==l.sendFormatted&&(f=c.unformat.date.call(this,f,d));c(this).jqGrid("setCell",e,b,f,!1,!1,!0);C.call(this,"afterRestoreCell",e,f,a,b);k.splice(0,1)}setTimeout(function(){c("#"+g.knv).attr("tabindex","-1").focus()},0)}})},nextCell:function(a,b){return this.each(function(){var g=c(this),d=this.p,
e=!1,f,l,k,h=this.rows;if(this.grid&&!0===d.cellEdit&&null!=h&&null!=h[a]){for(f=b+1;f<d.colModel.length;f++)if(k=d.colModel[f],l=k.editable,c.isFunction(l)&&(l=l.call(this,{rowid:h[a].id,iCol:f,iRow:a,name:k.name,cm:k,mode:"cell"})),!0===l){e=f;break}!1!==e?g.jqGrid("editCell",a,e,!0):0<d.savedRow.length&&g.jqGrid("saveCell",a,b)}})},prevCell:function(a,b){return this.each(function(){var g=c(this),d=this.p,e=!1,f,l,k,h=this.rows;if(this.grid&&!0===d.cellEdit&&null!=h&&null!=h[a]){for(f=b-1;0<=f;f--)if(k=
d.colModel[f],l=k.editable,c.isFunction(l)&&(l=l.call(this,{rowid:h[a].id,iCol:f,iRow:a,name:k.name,cm:k,mode:"cell"})),!0===l){e=f;break}!1!==e?g.jqGrid("editCell",a,e,!0):0<d.savedRow.length&&g.jqGrid("saveCell",a,b)}})},GridNav:function(){return this.each(function(){function a(a,b,e){a=g.rows[a];if("v"===e.substr(0,1)){var d=h.clientHeight,k=h.scrollTop,c=a.offsetTop+a.clientHeight,f=a.offsetTop;"vd"===e&&c>=d&&(h.scrollTop+=a.clientHeight);"vu"===e&&f<k&&(h.scrollTop-=a.clientHeight)}"h"===e&&
(e=h.scrollLeft,b=a.cells[b],a=b.offsetLeft,b.offsetLeft+b.clientWidth>=h.clientWidth+parseInt(e,10)?h.scrollLeft+=b.clientWidth:a<e&&(h.scrollLeft-=b.clientWidth))}function b(a,b){var g=0,d,h=e.colModel;if("lft"===b)for(g=a+1,d=a;0<=d;d--)if(!0!==h[d].hidden){g=d;break}if("rgt"===b)for(g=a-1,d=a;d<h.length;d++)if(!0!==h[d].hidden){g=d;break}return g}var g=this,d=c(g),e=g.p,f=g.grid,l,k;if(f&&!0===e.cellEdit){var h=f.bDiv;e.knv=e.id+"_kn";var n=c("<div style='position:fixed;top:0px;width:1px;height:1px;' tabindex='0'><div tabindex='-1' style='width:1px;height:1px;' id='"+
e.knv+"'></div></div>");c(n).insertBefore(f.cDiv);c("#"+e.knv).focus().keydown(function(h){var c=parseInt(e.iRow,10),f=parseInt(e.iCol,10);k=h.keyCode;"rtl"===e.direction&&(37===k?k=39:39===k&&(k=37));switch(k){case 38:0<c-1&&(a(c-1,f,"vu"),d.jqGrid("editCell",c-1,f,!1));break;case 40:c+1<=g.rows.length-1&&(a(c+1,f,"vd"),d.jqGrid("editCell",c+1,f,!1));break;case 37:0<=f-1&&(l=b(f-1,"lft"),a(c,l,"h"),d.jqGrid("editCell",c,l,!1));break;case 39:f+1<=e.colModel.length-1&&(l=b(f+1,"rgt"),a(c,l,"h"),d.jqGrid("editCell",
c,l,!1));break;case 13:0<=f&&0<=c&&d.jqGrid("editCell",c,f,!0);break;default:return!0}return!1})}})},getChangedCells:function(a){var b=[];a||(a="all");this.each(function(){var g=this,d=g.p,e=u.htmlDecode,f=g.rows;g.grid&&!0===d.cellEdit&&c(f).each(function(l){var k={};if(c(this).hasClass("edited")){var h=this;c(this.cells).each(function(b){var t=d.colModel[b],m=t.name,p=D.call(g,h,b);if("cb"!==m&&"subgrid"!==m&&"rn"!==m&&("dirty"!==a||p.hasClass("dirty-cell")))try{k[m]=c.unformat.call(g,p[0],{rowId:f[l].id,
colModel:t},b)}catch(q){k[m]=e(p.html())}});k.id=this.id;b.push(k)}})});return b}})});
//# sourceMappingURL=grid.celledit.map
